import React from "react";
import { useBiometricData } from "./useBiometricData";

const map = (value, inMin, inMax, outMin, outMax) => {
  return ((value - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin;
};

const requiredPermission = 0.5;

const Permission = () => {
  const { alcoholData, gsrData, heartbeatData } = useBiometricData();

  const getPermissionLevel = (alcoholData, gsrData, heartbeatData) => {
    const alcoholMapped = map(alcoholData, 0, 10, 0, 1);
    const gsrMapped = map(gsrData[gsrData.length - 1], 0, 1000, 0, 1);
    const heartbeatMapped = map(
      heartbeatData[heartbeatData.length - 1],
      0,
      200,
      0,
      1
    );

    const permissionLevel = (alcoholMapped + gsrMapped + heartbeatMapped) / 3;
    return permissionLevel;
  };

  const permissionLevel = getPermissionLevel(
    alcoholData,
    gsrData,
    heartbeatData
  );

  console.log(`#${Math.floor(map(permissionLevel, 0, 1, 0, 255))}`);

  const bgColor = map(permissionLevel, 0, 1, 0, 255);

  return (
    <div
      className="permission"
      style={{
        backgroundColor: `rgb(${bgColor},${bgColor},${bgColor})`
      }}
    >
      <h1 style={{ color: `rgb(${255 - bgColor},${bgColor},0)` }}>
        {permissionLevel > requiredPermission
          ? "You can speak"
          : "You need to drink more and raise your heartrate"}
      </h1>
    </div>
  );
};

export default Permission;
