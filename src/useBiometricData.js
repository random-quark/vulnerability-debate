import { useEffect, useState } from "react";

export const useBiometricData = () => {
  const [collectAlcoholData, setCollectAlcoholData] = useState(false);
  const [alcoholData, setAlcoholData] = useState(0);
  const [gsrData, setGsrData] = useState([0]);
  const [heartbeatData, setHeartbeatData] = useState([0]);

  useEffect(() => {
    const socket = new WebSocket("ws://localhost:8080");

    socket.onclose = () => console.log("Socket closed");
    socket.onopen = () => console.log("Socket connected");
    socket.onmessage = ({ data }) => {
      const [type, value] = data.split(":");

      if (type === "alcohol" && collectAlcoholData) {
        setAlcoholData(parseInt(value));
      }
      if (type === "gsr") {
        setGsrData(gsrData => [...gsrData, parseInt(value)].slice(-10));
      }
      if (type === "heartbeat") {
        setHeartbeatData(heartbeatData =>
          [...heartbeatData, parseInt(value)].slice(-10)
        );
      }
    };
  }, []);

  const startAlcohol = () => setCollectAlcoholData(true);
  const stopAlcohol = () => setCollectAlcoholData(true);

  return { alcoholData, gsrData, heartbeatData, startAlcohol, stopAlcohol };
};
